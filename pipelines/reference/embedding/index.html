
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../assets/">
      
      
        <link rel="next" href="../ingestion/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.36">
    
    
      
        <title>Embedding - TalkingCode</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.06209087.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipelines.processing.embedding" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="TalkingCode" class="md-header__button md-logo" aria-label="TalkingCode" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TalkingCode
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Embedding
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="TalkingCode" class="md-nav__button md-logo" aria-label="TalkingCode" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TalkingCode
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Backend
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Backend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/endpoints/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/reference/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/reference/errors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Errors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/reference/foo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Foo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/reference/main/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Main
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/reference/retrieve/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retrieve
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5_6" >
        
          
          <label class="md-nav__link" for="__nav_2_5_6" id="__nav_2_5_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tests
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5_6">
            <span class="md-nav__icon md-icon"></span>
            Tests
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../backend/reference/tests/fixtures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fixtures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Frontend
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Frontend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pipelines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Pipelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Embedding
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Embedding
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding" class="md-nav__link">
    <span class="md-ellipsis">
      embedding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.AuthHeader" class="md-nav__link">
    <span class="md-ellipsis">
      AuthHeader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AuthHeader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.AuthHeader.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingPersistence" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingPersistence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmbeddingService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService.embed_and_persist_files" class="md-nav__link">
    <span class="md-ellipsis">
      embed_and_persist_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService.get_file_content" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService.process_and_save" class="md-nav__link">
    <span class="md-ellipsis">
      process_and_save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingStore" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmbeddingStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingStore.find_files" class="md-nav__link">
    <span class="md-ellipsis">
      find_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingStore.save_embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      save_embeddings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingWithCount" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingWithCount
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.FileMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      FileMetadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.FileMetadata.from_db_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_db_object
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.OpenAIEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIEmbedder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      TextEmbedder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextEmbedder.embed_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      embed_chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      TextSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextSplitter.split_text_to_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      split_text_to_chunks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingestion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ingestion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding" class="md-nav__link">
    <span class="md-ellipsis">
      embedding
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.AuthHeader" class="md-nav__link">
    <span class="md-ellipsis">
      AuthHeader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AuthHeader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.AuthHeader.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingPersistence" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingPersistence
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmbeddingService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService.embed_and_persist_files" class="md-nav__link">
    <span class="md-ellipsis">
      embed_and_persist_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService.get_file_content" class="md-nav__link">
    <span class="md-ellipsis">
      get_file_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingService.process_and_save" class="md-nav__link">
    <span class="md-ellipsis">
      process_and_save
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingStore" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingStore
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EmbeddingStore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingStore.find_files" class="md-nav__link">
    <span class="md-ellipsis">
      find_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingStore.save_embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      save_embeddings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.EmbeddingWithCount" class="md-nav__link">
    <span class="md-ellipsis">
      EmbeddingWithCount
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.FileMetadata" class="md-nav__link">
    <span class="md-ellipsis">
      FileMetadata
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FileMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.FileMetadata.from_db_object" class="md-nav__link">
    <span class="md-ellipsis">
      from_db_object
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.OpenAIEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      OpenAIEmbedder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      TextEmbedder
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextEmbedder.embed_chunk" class="md-nav__link">
    <span class="md-ellipsis">
      embed_chunk
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextSplitter" class="md-nav__link">
    <span class="md-ellipsis">
      TextSplitter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextSplitter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pipelines.processing.embedding.TextSplitter.split_text_to_chunks" class="md-nav__link">
    <span class="md-ellipsis">
      split_text_to_chunks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Embedding</h1>

<div class="doc doc-object doc-module">



<a id="pipelines.processing.embedding"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.AuthHeader" class="doc doc-heading">
            <code>AuthHeader</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>Small dataclass to store the authorization header for the API requests.
Necessary for the requests to the GitHub API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>Authorization</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the authorization header. (for example <code>Authorization</code>)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>token</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The token to be used for authorization. This is the GitHub token, in this case
you need to request a classic GitHub token.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AuthHeader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Small dataclass to store the authorization header for the API requests.</span>
<span class="sd">    Necessary for the requests to the GitHub API.</span>

<span class="sd">    Args:</span>
<span class="sd">        Authorization (str): The name of the authorization header. (for example `Authorization`)</span>
<span class="sd">        token (str): The token to be used for authorization. This is the GitHub token, in this case</span>
<span class="sd">            you need to request a classic GitHub token.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Authorization</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the authorization header as a dictionary.</span>
<span class="sd">        The dictionary is used to pass the authorization header to the aiohttp library. This is necessary</span>
<span class="sd">        for the requests to the GitHub API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: The authorization header as a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.AuthHeader.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the authorization header as a dictionary.
The dictionary is used to pass the authorization header to the aiohttp library. This is necessary
for the requests to the GitHub API.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#dict">dict</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, str]: The authorization header as a dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the authorization header as a dictionary.</span>
<span class="sd">    The dictionary is used to pass the authorization header to the aiohttp library. This is necessary</span>
<span class="sd">    for the requests to the GitHub API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, str]: The authorization header as a dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.EmbeddingPersistence" class="doc doc-heading">
            <code>EmbeddingPersistence</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.EmbeddingStore" href="#pipelines.processing.embedding.EmbeddingStore">EmbeddingStore</a></code></p>


        <p>A class that implements the EmbeddingStore protocol.
It is used to store the embeddings in the database as well as retrieve the
metadata of the files that are to be embedded.</p>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmbeddingPersistence</span><span class="p">(</span><span class="n">EmbeddingStore</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that implements the EmbeddingStore protocol.</span>
<span class="sd">    It is used to store the embeddings in the database as well as retrieve the</span>
<span class="sd">    metadata of the files that are to be embedded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">session_maker</span><span class="p">:</span> <span class="n">sessionmaker</span><span class="p">[</span><span class="n">Session</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">white_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">blacklisted_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FileMetadata</span><span class="p">]:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">GithubFileModel</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GithubFileModel</span><span class="o">.</span><span class="n">is_embedded</span><span class="o">.</span><span class="n">is_</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GithubFileModel</span><span class="o">.</span><span class="n">file_extension</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">white_list</span><span class="p">))</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GithubFileModel</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">not_in</span><span class="p">(</span><span class="n">blacklisted_files</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_maker</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files to embed.&quot;</span><span class="p">)</span>
        <span class="n">github_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">FileMetadata</span><span class="o">.</span><span class="n">from_db_object</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">github_files</span>

    <span class="k">def</span> <span class="nf">save_embeddings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">EmbeddingWithCount</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">embedded_document</span> <span class="o">=</span> <span class="n">EmbeddedDocumentModel</span><span class="p">(</span>
            <span class="n">document_id</span><span class="o">=</span><span class="n">metadata</span><span class="o">.</span><span class="n">document_id</span><span class="p">,</span>
            <span class="n">embedding</span><span class="o">=</span><span class="n">embeddings</span><span class="o">.</span><span class="n">embedding</span><span class="p">,</span>
            <span class="n">input_token_count</span><span class="o">=</span><span class="n">embeddings</span><span class="o">.</span><span class="n">total_tokens</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">original_file</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">GithubFileModel</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">GithubFileModel</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">metadata</span><span class="o">.</span><span class="n">document_id</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_maker</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">orig</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">original_file</span><span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">orig</span><span class="p">:</span>
                <span class="n">orig</span><span class="o">.</span><span class="n">is_embedded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">embedded_document</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.EmbeddingService" class="doc doc-heading">
            <code>EmbeddingService</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>This class is used to embed files and save the embeddings to the database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>db</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.EmbeddingStore" href="#pipelines.processing.embedding.EmbeddingStore">EmbeddingStore</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The database object that is used to store the embeddings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>embedder</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.TextEmbedder" href="#pipelines.processing.embedding.TextEmbedder">TextEmbedder</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object that is used to embed the files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>auth_header</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.AuthHeader" href="#pipelines.processing.embedding.AuthHeader">AuthHeader</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authorization header for the API requests.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>blacklisted_files</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of file names that are not allowed to be embedded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>white_list</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of file extensions that are allowed to be embedded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>splitter</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.TextSplitter" href="#pipelines.processing.embedding.TextSplitter">TextSplitter</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The object that is used to split the text into chunks.</p>
              </div>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.TextSplitter" href="#pipelines.processing.embedding.TextSplitter">TextSplitter</a>()</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmbeddingService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to embed files and save the embeddings to the database.</span>

<span class="sd">    Args:</span>
<span class="sd">        db (EmbeddingStore): The database object that is used to store the embeddings.</span>
<span class="sd">        embedder (TextEmbedder): The object that is used to embed the files.</span>
<span class="sd">        auth_header (AuthHeader): The authorization header for the API requests.</span>
<span class="sd">        blacklisted_files (list[str]): The list of file names that are not allowed to be embedded.</span>
<span class="sd">        white_list (list[str]): The list of file extensions that are allowed to be embedded.</span>
<span class="sd">        splitter (TextSplitter): The object that is used to split the text into chunks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">db</span><span class="p">:</span> <span class="n">EmbeddingStore</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">TextEmbedder</span>
    <span class="n">auth_header</span><span class="p">:</span> <span class="n">AuthHeader</span>
    <span class="n">blacklisted_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">white_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">splitter</span><span class="p">:</span> <span class="n">TextSplitter</span> <span class="o">=</span> <span class="n">TextSplitter</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">embed_and_persist_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Embeds the files and saves the embeddings to the database.</span>
<span class="sd">        We do this in two steps:</span>
<span class="sd">        1. Fetch the files from the GitHub API.</span>
<span class="sd">        2. Embed the files and save the embeddings to the</span>
<span class="sd">        database.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">white_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklisted_files</span><span class="p">)</span>
        <span class="n">file_futures</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="k">for</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">]</span>

        <span class="n">file_contents</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">file_futures</span><span class="p">)</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetched all files. Starting to embed.&quot;</span><span class="p">)</span>
        <span class="n">embedding_futures</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_and_save</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">file_contents</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">embedding_futures</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_file_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches the file content from the GitHub API.</span>
<span class="sd">        The database doesn&#39;t store the content of the file,</span>
<span class="sd">        so we need to fetch it from the GitHub API.</span>

<span class="sd">        Args:</span>
<span class="sd">            metadata (FileMetadata): The metadata of the file to fetch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The code that is stored in the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Fetching document </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">repository_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">content_url</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_header</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_and_save</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Embeds the code and saves the embeddings to the database.</span>
<span class="sd">        The metadata is also added while saving the embeddings to add things</span>
<span class="sd">        like the file name, extensions, path, repository and so on.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): The code to embed.</span>
<span class="sd">            metadata (FileMetadata): The metadata of the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">split_text_to_chunks</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">embed_chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">embedding</span> <span class="ow">in</span> <span class="n">embeddings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">save_embeddings</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.EmbeddingService.embed_and_persist_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_and_persist_files</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Embeds the files and saves the embeddings to the database.
We do this in two steps:
1. Fetch the files from the GitHub API.
2. Embed the files and save the embeddings to the
database.</p>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">embed_and_persist_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Embeds the files and saves the embeddings to the database.</span>
<span class="sd">    We do this in two steps:</span>
<span class="sd">    1. Fetch the files from the GitHub API.</span>
<span class="sd">    2. Embed the files and save the embeddings to the</span>
<span class="sd">    database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">find_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">white_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blacklisted_files</span><span class="p">)</span>
    <span class="n">file_futures</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_file_content</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="k">for</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">]</span>

    <span class="n">file_contents</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">file_futures</span><span class="p">)</span>
    <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetched all files. Starting to embed.&quot;</span><span class="p">)</span>
    <span class="n">embedding_futures</span> <span class="o">=</span> <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_and_save</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">file_contents</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">embedding_futures</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.EmbeddingService.get_file_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_file_content</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Fetches the file content from the GitHub API.
The database doesn't store the content of the file,
so we need to fetch it from the GitHub API.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>metadata</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.FileMetadata" href="#pipelines.processing.embedding.FileMetadata">FileMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata of the file to fetch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code that is stored in the file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_file_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches the file content from the GitHub API.</span>
<span class="sd">    The database doesn&#39;t store the content of the file,</span>
<span class="sd">    so we need to fetch it from the GitHub API.</span>

<span class="sd">    Args:</span>
<span class="sd">        metadata (FileMetadata): The metadata of the file to fetch.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The code that is stored in the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">app_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Fetching document </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">metadata</span><span class="o">.</span><span class="n">repository_name</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">content_url</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_header</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.EmbeddingService.process_and_save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_and_save</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Embeds the code and saves the embeddings to the database.
The metadata is also added while saving the embeddings to add things
like the file name, extensions, path, repository and so on.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code to embed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>metadata</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.FileMetadata" href="#pipelines.processing.embedding.FileMetadata">FileMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">process_and_save</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Embeds the code and saves the embeddings to the database.</span>
<span class="sd">    The metadata is also added while saving the embeddings to add things</span>
<span class="sd">    like the file name, extensions, path, repository and so on.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The code to embed.</span>
<span class="sd">        metadata (FileMetadata): The metadata of the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splitter</span><span class="o">.</span><span class="n">split_text_to_chunks</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="n">embeddings</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedder</span><span class="o">.</span><span class="n">embed_chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">embedding</span> <span class="ow">in</span> <span class="n">embeddings</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">save_embeddings</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.EmbeddingStore" class="doc doc-heading">
            <code>EmbeddingStore</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="typing.Protocol" href="https://docs.python.org/3/library/typing.html#typing.Protocol">Protocol</a></code></p>


        <p>This class is used to store embeddings as well as retrieve file metadata required for the embedding process.</p>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EmbeddingStore</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to store embeddings as well as retrieve file metadata required for the embedding process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">white_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">blacklisted_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FileMetadata</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the files that are not yet embedded and are in the white list and not in the black list.</span>
<span class="sd">        The reason is that we use ELT instead of ETL, all files are ingested and then filtered</span>
<span class="sd">        out based on the white list and black list.</span>

<span class="sd">        Args:</span>
<span class="sd">            white_list (list[str]): The list of file extensions that are allowed to be embedded.</span>
<span class="sd">            blacklisted_files (list[str]): The list of file names that are not allowed to be embedded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (list[FileMetadata]): The list of files that are allowed to be embedded.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">save_embeddings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">EmbeddingWithCount</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the embeddings to the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            embeddings (EmbeddingWithCount): The embeddings to save.</span>
<span class="sd">            metadata (FileMetadata): The metadata of the file that was embedded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.EmbeddingStore.find_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_files</span><span class="p">(</span><span class="n">white_list</span><span class="p">,</span> <span class="n">blacklisted_files</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Finds the files that are not yet embedded and are in the white list and not in the black list.
The reason is that we use ELT instead of ETL, all files are ingested and then filtered
out based on the white list and black list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>white_list</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of file extensions that are allowed to be embedded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>blacklisted_files</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of file names that are not allowed to be embedded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-internal" title="pipelines.processing.embedding.FileMetadata" href="#pipelines.processing.embedding.FileMetadata">FileMetadata</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of files that are allowed to be embedded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_files</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">white_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">blacklisted_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">FileMetadata</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the files that are not yet embedded and are in the white list and not in the black list.</span>
<span class="sd">    The reason is that we use ELT instead of ETL, all files are ingested and then filtered</span>
<span class="sd">    out based on the white list and black list.</span>

<span class="sd">    Args:</span>
<span class="sd">        white_list (list[str]): The list of file extensions that are allowed to be embedded.</span>
<span class="sd">        blacklisted_files (list[str]): The list of file names that are not allowed to be embedded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list[FileMetadata]): The list of files that are allowed to be embedded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.EmbeddingStore.save_embeddings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_embeddings</span><span class="p">(</span><span class="n">embeddings</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Saves the embeddings to the database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>embeddings</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.EmbeddingWithCount" href="#pipelines.processing.embedding.EmbeddingWithCount">EmbeddingWithCount</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The embeddings to save.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>metadata</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.FileMetadata" href="#pipelines.processing.embedding.FileMetadata">FileMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata of the file that was embedded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_embeddings</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">:</span> <span class="n">EmbeddingWithCount</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the embeddings to the database.</span>

<span class="sd">    Args:</span>
<span class="sd">        embeddings (EmbeddingWithCount): The embeddings to save.</span>
<span class="sd">        metadata (FileMetadata): The metadata of the file that was embedded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.EmbeddingWithCount" class="doc doc-heading">
            <code>EmbeddingWithCount</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>This class is used to store the embeddings of a file as well as the total number of tokens in the file.
We store the total number of tokens in the file so that we can calculate the cost of the embedding.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>embedding</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The embeddings of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>total_tokens</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of tokens in the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EmbeddingWithCount</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to store the embeddings of a file as well as the total number of tokens in the file.</span>
<span class="sd">    We store the total number of tokens in the file so that we can calculate the cost of the embedding.</span>

<span class="sd">    Args:</span>
<span class="sd">        embedding (list[float]): The embeddings of the file.</span>
<span class="sd">        total_tokens (int): The total number of tokens in the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">embedding</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">total_tokens</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.FileMetadata" class="doc doc-heading">
            <code>FileMetadata</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>This class is used to store metadata about the files that are to be embedded.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>repository_name</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the repository that the file belongs to.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>document_id</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The id of the document in the database.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file</code></td>
            <td>
                  <code><span title="pipelines.processing.ingestion.GitHubFile">GitHubFile</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file object that contains metadata about the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">FileMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to store metadata about the files that are to be embedded.</span>

<span class="sd">    Args:</span>
<span class="sd">        repository_name (str): The name of the repository that the file belongs to.</span>
<span class="sd">        document_id (int): The id of the document in the database.</span>
<span class="sd">        file (GitHubFile): The file object that contains metadata about the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">repository_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">document_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">file</span><span class="p">:</span> <span class="n">GitHubFile</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_db_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">GithubFileModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a FileMetadata object from a GithubFileModel object.</span>
<span class="sd">        The point is to convert the database object into a domain object.</span>


<span class="sd">        Args:</span>
<span class="sd">            file (GithubFileModel): The database object to convert.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self: The domain object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">repository_name</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">repository_name</span><span class="p">,</span>
            <span class="n">document_id</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">file</span><span class="o">=</span><span class="n">GitHubFile</span><span class="o">.</span><span class="n">from_db_object</span><span class="p">(</span><span class="n">file</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.FileMetadata.from_db_object" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_db_object</span><span class="p">(</span><span class="n">file</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a FileMetadata object from a GithubFileModel object.
The point is to convert the database object into a domain object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>file</code></td>
            <td>
                  <code><span title="shared.database.GithubFileModel">GithubFileModel</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The database object to convert.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Self</code></td>            <td>
                  <code><a class="autorefs autorefs-external" title="typing.Self" href="https://docs.python.org/3/library/typing.html#typing.Self">Self</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The domain object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_db_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">GithubFileModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a FileMetadata object from a GithubFileModel object.</span>
<span class="sd">    The point is to convert the database object into a domain object.</span>


<span class="sd">    Args:</span>
<span class="sd">        file (GithubFileModel): The database object to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Self: The domain object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">repository_name</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">repository_name</span><span class="p">,</span>
        <span class="n">document_id</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">file</span><span class="o">=</span><span class="n">GitHubFile</span><span class="o">.</span><span class="n">from_db_object</span><span class="p">(</span><span class="n">file</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.OpenAIEmbedder" class="doc doc-heading">
            <code>OpenAIEmbedder</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.TextEmbedder" href="#pipelines.processing.embedding.TextEmbedder">TextEmbedder</a></code></p>


        <p>A TextEmbedder implementation that uses the OpenAI API to embed text.
Args:
    api_client (AsyncOpenAI): The OpenAI API client to use.
    embedding_model (str): The name of the embedding model to use.</p>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">OpenAIEmbedder</span><span class="p">(</span><span class="n">TextEmbedder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A TextEmbedder implementation that uses the OpenAI API to embed text.</span>
<span class="sd">    Args:</span>
<span class="sd">        api_client (AsyncOpenAI): The OpenAI API client to use.</span>
<span class="sd">        embedding_model (str): The name of the embedding model to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">api_client</span><span class="p">:</span> <span class="n">AsyncOpenAI</span>
    <span class="n">embedding_model</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">embed_chunk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EmbeddingWithCount</span><span class="p">]:</span>
        <span class="n">enriched_content</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enrich_file_content</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">metadata</span><span class="o">.</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span>
        <span class="p">]</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_embed_document</span><span class="p">(</span><span class="n">enriched_content</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">embeddings</span>

    <span class="k">def</span> <span class="nf">_enrich_file_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">file</span><span class="p">:</span> <span class="n">GitHubFile</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The file name is </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">file_place_in_project</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The file is located at </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">path_in_project</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">file_extension</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The file extension is </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">extension</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">file_content</span> <span class="o">+</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">file_place_in_project</span> <span class="o">+</span> <span class="n">file_extension</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_embed_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EmbeddingWithCount</span><span class="p">]:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_embed_documents_with_retry</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_embed_documents_with_retry</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EmbeddingWithCount</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
            <span class="n">futures</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Coroutine</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">CreateEmbeddingResponse</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                    <span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_client</span><span class="o">.</span><span class="n">embeddings</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_model</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="n">chunk</span>
                    <span class="p">)</span>
                    <span class="n">futures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>

                <span class="n">responses</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">futures</span><span class="p">)</span>
                <span class="n">embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_responses</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">embeddings</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">app_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received an internal server error. </span><span class="si">{</span><span class="n">attempt</span><span class="si">}</span><span class="s2">s left&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve embeddings after maximum retries.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">responses</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">CreateEmbeddingResponse</span><span class="p">]):</span>
        <span class="n">embeddings</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">EmbeddingWithCount</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">embedding_vec</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">embedding</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="n">EmbeddingWithCount</span><span class="p">(</span><span class="n">embedding_vec</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
            <span class="n">embeddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embeddings</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.TextEmbedder" class="doc doc-heading">
            <code>TextEmbedder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-external" title="typing.Protocol" href="https://docs.python.org/3/library/typing.html#typing.Protocol">Protocol</a></code></p>


        <p>This class is used to embed text, it takes text and metadata and returns the embedding
and the total number of tokens in the text.</p>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TextEmbedder</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to embed text, it takes text and metadata and returns the embedding</span>
<span class="sd">    and the total number of tokens in the text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">embed_chunk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EmbeddingWithCount</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Embeds the text and returns the embeddings and the total number of tokens in the text.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): The code to embed.</span>
<span class="sd">            metadata (FileMetadata): The metadata of the file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[EmbeddingWithCount]: The embeddings and the total number of tokens in the text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.TextEmbedder.embed_chunk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">embed_chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Embeds the text and returns the embeddings and the total number of tokens in the text.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code to embed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>metadata</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="pipelines.processing.embedding.FileMetadata" href="#pipelines.processing.embedding.FileMetadata">FileMetadata</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metadata of the file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-internal" title="pipelines.processing.embedding.EmbeddingWithCount" href="#pipelines.processing.embedding.EmbeddingWithCount">EmbeddingWithCount</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[EmbeddingWithCount]: The embeddings and the total number of tokens in the text.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">embed_chunk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">chunks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">FileMetadata</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">EmbeddingWithCount</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Embeds the text and returns the embeddings and the total number of tokens in the text.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The code to embed.</span>
<span class="sd">        metadata (FileMetadata): The metadata of the file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[EmbeddingWithCount]: The embeddings and the total number of tokens in the text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pipelines.processing.embedding.TextSplitter" class="doc doc-heading">
            <code>TextSplitter</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">


        <p>This class is used to split the text into chunks of 7000 tokens.
This is necessary because the OpenAI API has a limit of 8000 tokens per request.
We split the text into chunks of 7000 tokens to account for the tokens used by the metadata.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>encoding</code></td>
            <td>
                  <code><span title="tiktoken.Encoding">Encoding</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The encoding to use for tokenization.</p>
              </div>
            </td>
            <td>
                  <code><span title="tiktoken.get_encoding">get_encoding</span>(&#39;cl100k_base&#39;)</code>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">slots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TextSplitter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to split the text into chunks of 7000 tokens.</span>
<span class="sd">    This is necessary because the OpenAI API has a limit of 8000 tokens per request.</span>
<span class="sd">    We split the text into chunks of 7000 tokens to account for the tokens used by the metadata.</span>

<span class="sd">    Args:</span>
<span class="sd">        encoding (Encoding): The encoding to use for tokenization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">encoding</span><span class="p">:</span> <span class="n">Encoding</span> <span class="o">=</span> <span class="n">tiktoken</span><span class="o">.</span><span class="n">get_encoding</span><span class="p">(</span><span class="s2">&quot;cl100k_base&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">split_text_to_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits the text into chunks of 7000 tokens.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): The text to split.</span>
<span class="sd">            name (str): The name of the file. Used for logging.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: The list of chunks.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_tokens</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">//</span> <span class="mi">7000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">char_per_chunk</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_chunks</span>
        <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Splitting </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> into </span><span class="si">{</span><span class="n">num_chunks</span><span class="si">}</span><span class="s2"> chunks of </span><span class="si">{</span><span class="n">char_per_chunk</span><span class="si">}</span><span class="s2"> characters.&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">text</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">char_per_chunk</span><span class="p">]</span>  <span class="c1"># noqa E203</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">char_per_chunk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># + 1 is added for empty files</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_count_tokens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">num_tokens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">num_tokens</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pipelines.processing.embedding.TextSplitter.split_text_to_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_text_to_chunks</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Splits the text into chunks of 7000 tokens.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>text</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to split.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>name</code></td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the file. Used for logging.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]: The list of chunks.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>pipelines/pipelines/processing/embedding.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_text_to_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits the text into chunks of 7000 tokens.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The text to split.</span>
<span class="sd">        name (str): The name of the file. Used for logging.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: The list of chunks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_count_tokens</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">num_chunks</span> <span class="o">=</span> <span class="p">(</span><span class="n">tokens</span> <span class="o">//</span> <span class="mi">7000</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">char_per_chunk</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_chunks</span>
    <span class="n">app_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Splitting </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> into </span><span class="si">{</span><span class="n">num_chunks</span><span class="si">}</span><span class="s2"> chunks of </span><span class="si">{</span><span class="n">char_per_chunk</span><span class="si">}</span><span class="s2"> characters.&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">text</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">char_per_chunk</span><span class="p">]</span>  <span class="c1"># noqa E203</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">char_per_chunk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># + 1 is added for empty files</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>